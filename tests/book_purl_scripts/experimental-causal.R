library(DeclareDesign); library(rdddr); library(tidyverse)

## ---- echo = TRUE---------------------------------------------------------------------------------------
# ------------------------------
# Two-arm randomized experiments
# ------------------------------

## ----file = "scripts_declarations/declaration_18.1_NEW.R"-----------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_18.1 <- diagnose_design(declaration_18.1)


## ---- echo = TRUE---------------------------------------------------------------------------------------
# ------------------------------------------------------------------------
# Two-arm randomized experiments :: Using covariates to increase precision
# ------------------------------------------------------------------------

## ----file = "scripts_declarations/declaration_18.2_NEW.R"-----------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_18.2 <- 
  declaration_18.2 %>% 
  redesign(r_sq = seq(0.0, 0.9, by = 0.2)) %>% 
  diagnose_designs() 


## ---- echo = TRUE---------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------
# Two-arm randomized experiments :: Can controlling for covariates hurt precision?
# --------------------------------------------------------------------------------

## ----file = "scripts_declarations/declaration_17.5.R"---------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.5 <- 
  declaration_17.5 %>% 
  redesign(
    control_slope = seq(-1, 1, 0.5), 
    prob = seq(0.1, 0.9, 0.1)) %>% 
  diagnose_designs()


## ---- echo = TRUE---------------------------------------------------------------------------------------
# ----------------------------
# Block-randomized experiments
# ----------------------------

## ----file = "scripts_declarations/declaration_17.2.R"---------------------------------------------------


## ---- echo = TRUE---------------------------------------------------------------------------------------
# ------------------------------
# Cluster-randomized experiments
# ------------------------------

## ----file = "scripts_declarations/declaration_17.6.R"---------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.6 <-
  declaration_17.6 %>%
  redesign(ICC = seq(0.1, 0.9, by = 0.4)) %>% 
  diagnose_designs()


## ---- echo = TRUE---------------------------------------------------------------------------------------
# ----------------
# Subgroup designs
# ----------------

## ----file = "scripts_declarations/declaration_17.7.R"---------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.7 <- 
  declaration_17.7 %>% 
  redesign(n_x1 = seq(20, 980, by = 96)) %>% 
  diagnose_designs()


## ---- echo = TRUE---------------------------------------------------------------------------------------
# ---------------------
# Factorial experiments
# ---------------------

## ----file = "scripts_declarations/declaration_17.8.R"---------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.8 <-
  declaration_17.8 %>% 
  redesign(N = seq(500, 3000, 500)) %>% 
  diagnose_designs()


## ---- echo = TRUE---------------------------------------------------------------------------------------
# -------------------------------------------------------
# Factorial experiments :: Avoiding misleading inferences
# -------------------------------------------------------

## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.9 <- 
  declaration_17.8 %>% 
  redesign(
    CATE_Z1_Z2_0 = seq(0, 0.5, 0.05),
    CATE_Z2_Z1_0 = 0.2,
    interaction = 0
  ) %>% 
  diagnose_designs()


## ---- echo = TRUE---------------------------------------------------------------------------------------
# -------------------------------------------------------
# Encouragement designs :: Changes to the answer strategy
# -------------------------------------------------------

## ----file = "scripts_declarations/declaration_17.9.R"---------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.10 <- diagnose_design(declaration_17.9)


## ---- echo = TRUE---------------------------------------------------------------------------------------
# ------------------------------
# Placebo-controlled experiments
# ------------------------------

## ----file = "scripts_declarations/declaration_17.11a.R"-------------------------------------------------



## ----file = "scripts_declarations/declaration_17.11b.R"-------------------------------------------------


## ----file = "scripts_declarations/declaration_17.11c.R"-------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.11a <- 
  encouragement_design %>% 
  redesign(compliance_rate = seq(0.1, 0.9, by = 0.1)) %>% 
  diagnose_designs()

diagnosis_17.11b <- 
  placebo_controlled_design %>% 
  redesign(compliance_rate = seq(0.1, 0.9, by = 0.1)) %>% 
  diagnose_designs()


## ---- echo = TRUE---------------------------------------------------------------------------------------
# -------------------------
# Stepped-wedge experiments
# -------------------------

## ----file = "scripts_declarations/declaration_17.12.R"--------------------------------------------------


## ---- echo = TRUE---------------------------------------------------------------------------------------
# -------------------------------------------------------------------
# Stepped-wedge experiments :: When to use a stepped wedge experiment
# -------------------------------------------------------------------

## ----file = "scripts_declarations/declaration_17.13.R"--------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
design_stepped_wedge <- 
  declaration_17.12 %>% 
  redesign(n_units = 100, effect_size = seq(from = 0, to = 0.75, by = 0.05))

design_single_period_100 <- 
  declaration_17.13 %>% 
  redesign(n_units = 100, effect_size = seq(from = 0, to = 0.75, by = 0.05))
  
design_single_period_200 <-
  declaration_17.13 %>% 
  redesign(n_units = 200, effect_size = seq(from = 0, to = 0.75, by = 0.05))

designs <- c(design_stepped_wedge, design_single_period_100, design_single_period_200)
attr(designs, "names") <- paste0("design_", 1:length(designs))

diagnosis_17.12 <- diagnose_design(designs)


## ---- echo = TRUE---------------------------------------------------------------------------------------
# ---------------------------------
# Randomized saturation experiments
# ---------------------------------

## ----file = "scripts_declarations/declaration_17.15.R"--------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.14 <- diagnose_design(declaration_17.15)


## ---- echo = TRUE---------------------------------------------------------------------------------------
# ------------------------------------
# Experiments over networks :: Example
# ------------------------------------

## ----file = "scripts_declarations/declaration_17.16.R"--------------------------------------------------


## ----eval = TRUE----------------------------------------------------------------------------------------
diagnosis_17.15 <- diagnose_design(declaration_17.16)


