## ---- echo = TRUE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ---------------------------
# Declaring inquiries in code
# ---------------------------

## ----results = "hide"----------------------------------------------------------------------------------------------------------------------------------------------------------------------
M <- declare_model(N = 100, U = rnorm(N), potential_outcomes(Y ~ Z + U))
I <- declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0))


## ----results = "hide"----------------------------------------------------------------------------------------------------------------------------------------------------------------------
M <- declare_model(N = 100, Y = rnorm(N))
I <- declare_inquiry(mean_Y = mean(Y))


## ---- echo = TRUE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ---------------------------------------------------------------
# Declaring inquiries in code :: Inquiries among subsets of units
# ---------------------------------------------------------------

## ----eval = TRUE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
M <- declare_model(
  N = 100, 
    U = rnorm(N), 
    X = rbinom(N, 1, prob = 0.5),
    potential_outcomes(Y ~  0.3 * Z + 0.2*X + 0.1*Z*X + U))
I <- declare_inquiry(CATE = mean(Y_Z_1 - Y_Z_0), subset = X == 1)


## ----eval = TRUE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
I <- declare_inquiry(CATE = mean(Y_Z_1[X == 1] - Y_Z_0[X == 1]))


## ---- echo = TRUE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ---------------------------------------------------------------------------
# Declaring inquiries in code :: Inquiries with continuous potential outcomes
# ---------------------------------------------------------------------------

## ----results = "hide"----------------------------------------------------------------------------------------------------------------------------------------------------------------------
cutoff <- 0.5
control <- function(X) {
  as.vector(poly(X, 4, raw = TRUE) %*% c(.7, -.8, .5, 1))}
treatment <- function(X) {
  as.vector(poly(X, 4, raw = TRUE) %*% c(0, -1.5, .5, .8)) + .15}

I <- declare_inquiry(LATE = treatment(cutoff) - control(cutoff))


## ---- echo = TRUE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# -------------------------------------------------
# Declaring inquiries in code :: Multiple inquiries
# -------------------------------------------------

## ----eval = TRUE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
I <- declare_inquiry(
  ATE = CATE_X1 = mean(Y_Z_1[X == 1] - Y_Z_0[X == 1]),
  CATE_X0 = mean(Y_Z_1[X == 0] - Y_Z_0[X == 0]),
  CATE_X1 = mean(Y_Z_1[X == 1] - Y_Z_0[X == 1]),
  Difference_in_CATEs = CATE_X1 - CATE_X0)


## ----results = "hide"----------------------------------------------------------------------------------------------------------------------------------------------------------------------
M <- 
  declare_model(
    counties = add_level(N = 5, county_quality_mean = rnorm(N)),
    schools = add_level(N = 5, school_quality = rnorm(N, mean = county_quality_mean))
  )

MRP_inquiry <- 
  function(data) {
    data %>% 
      group_by(counties) %>% 
      summarize(mean_school_quality = mean(school_quality),
                .groups = "drop")
  }

I <- declare_inquiry(handler = MRP_inquiry)

