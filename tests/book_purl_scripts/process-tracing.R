## ---- echo = TRUE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ---------------
# Process tracing
# ---------------

## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
model <- make_model("X -> M -> Y <- W -> M") %>%
  set_restrictions("(M[X=1] < M[X=0]) | (M[X=1, W=1] == M[X=0, W=1])") %>%
  set_restrictions("(Y[M=1] < Y[M=0]) | (Y[M=1, W=1] == Y[M=0, W=1])")

plot(model)


## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
queries <- 
  CausalQueries::query_model(
    model,
    query = list('Prob(CoE=1)' = "Y[X=1] > Y[X=0]",
                 'Prob(M=1)' = "M==1",
                 'Prob(CoE=1 | M=0)' = "Y[X=1] > Y[X=0]",
                 'Prob(CoE=1 | M=1)' = "Y[X=1] > Y[X=0]"),
    given = list("Y==1 & X==1",
                 "Y==1 & X==1",
                 "Y==1 & X==1 & M==0",
                 "Y==1 & X==1 & M==1"),
    using = "parameters") 


## ----eval = TRUE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
design <- 
  declare_model(data = data_function()) + 
  declare_inquiry(CoE = CoE) +
  declare_estimator(handler = my_estimator_function)

